(* File automatically generated by CADL *)
open CadlLib
open Printf

let u_vzero = 0x00;;

let u_vone = 0x01;;

let u_vtwo = 0x02;;

let u_vthree = 0x03;;

let u_vfour = 0x04;;

let u_vfive = 0x05;;

let u_vleft = 0x4c;;

let u_vright = 0x52;;

let u_va = 0x61;;

let u_vb = 0x62;;

let u_vsharp = 0x23;;

let u_VFSM = (cMatrixMake (10, 5, 8) [|u_vzero; u_vsharp; u_vfour; u_vsharp;
u_vright; u_vzero; u_va; u_vone; u_vsharp; u_vright; u_vfour; u_vsharp; u_vfive;
u_vsharp; u_vright; u_vone; u_va; u_vone; u_va; u_vright; u_vone; u_vb; u_vone;
u_vb; u_vright; u_vone; u_vsharp; u_vtwo; u_vsharp; u_vleft; u_vtwo; u_vb;
u_vthree; u_vsharp; u_vleft; u_vthree; u_va; u_vthree; u_va; u_vleft; u_vthree;
u_vb; u_vthree; u_vb; u_vleft; u_vthree; u_vsharp; u_vzero; u_vsharp; u_vright|]);;

let rec u_fSymbolAt u_VTape u_vPos u_vBlank = begin
    let u_vTapeLen = (cY u_VTape) in
  if ((u_vPos >= u_vTapeLen)) then begin
    u_vBlank
  end else begin
    (cMatrixSingle u_VTape (0, u_vPos, 7, 0))
  end
end;;

let rec u_FReplaceSymbol u_VTape u_vPos u_vSymbol = begin
    let u_vLen = (cY u_VTape) in
    let u_vLenRet =   if ((u_vPos == u_vLen)) then begin
    u_vLen + 1
    ;
  end else begin
    u_vLen
  end
 in
  let u_VRet = (cMatrixMake (1, u_vLenRet, 8) [|0x00|]) in
  for u_vCnt=0 to (u_vLenRet - 1) do
    if ((u_vCnt == u_vPos)) then begin
      u_VRet.(0).(u_vCnt) <- u_vSymbol
    end else begin
      u_VRet.(0).(u_vCnt) <- (cMatrixSingle u_VTape (0, u_vCnt, 7, 0));
    end
  done
  ;
  u_VRet
end;;

let rec u_fAcceptState u_VStates u_vState = begin
    let u_vY = (cY u_VStates) in
  let u_VRes = (cMatrixMake (1, 1, 8) [|0x00|]) in
  for u_vCnt0=0 to (u_vY - 1) do
    if (((cMatrixSingle u_VStates (0, u_vCnt0, 7, 0)) == u_vState)) then begin
      u_VRes.(0).(0) <- 0x01
    end
  done
  ;
    let u_vRet = (cMatrixSingle u_VRes (0, 0, 7, 0)) in
  u_vRet
end;;

let rec u_FTransState u_VStates u_vState u_vSymbol = begin
    let u_vX = (cX u_VStates) in
  let u_VRes = (cMatrixMake (1, 3, 8) [|0xff|]) in
  for u_vCnt=0 to (u_vX - 1) do
    if ((((cMatrixSingle u_VStates (u_vCnt, 0, 7, 0)) == u_vState) && ((cMatrixSingle u_VStates (u_vCnt, 1, 7, 0)) == u_vSymbol))) then begin
      u_VRes.(0).(0) <- (cMatrixSingle u_VStates (u_vCnt, 2, 7, 0)); (* next state *)
      u_VRes.(0).(1) <- (cMatrixSingle u_VStates (u_vCnt, 3, 7, 0)); (* overwirte value *)
      u_VRes.(0).(2) <- (cMatrixSingle u_VStates (u_vCnt, 4, 7, 0))  (* shift left/right *)
      (*
      printf "u_vX:%d\n" u_vX;
      printf "u_vCnt:%d\n" u_vCnt;
      printf "OK\n";
      printf "OK0 %d\n" u_VStates.(u_vCnt).(3);
      printf "OK1\n";
      *)
    end
  done
  ;
  u_VRes
end;;

let vStep = ref 0;;
let rec u_fSimulate u_VTape u_VAccepts u_VStates u_vState u_vHeadPos u_vBlank = begin
    printf "\nstep:%d\n" !vStep;
    vStep := !vStep + 1;
    cPrintMvar u_VTape "VTape";
    printf "u_vState:0x%x u_vHeadPos:0x%x\n" u_vState u_vHeadPos;
    if (!vStep < 10) then begin
    let u_vRet =   if ((u_vState == 0xff)) then begin
    0xff
  end else begin
    if ((0x01 == (u_fAcceptState (u_VAccepts) (u_vState)))) then begin
      0x01
    end else begin
      let u_vSymbol = (u_fSymbolAt (u_VTape) (u_vHeadPos) (u_vBlank)) in
      printf "u_vSymbol:0x%x\n" u_vSymbol;
      let u_VNewState = (u_FTransState (u_VStates) (u_vState) (u_vSymbol)) in
      let u_vNState = (cMatrixSingle u_VNewState (0, 0, 7, 0)) in
      let u_vNSymbol = (cMatrixSingle u_VNewState (0, 1, 7, 0)) in
      (*
      cPrintMvar u_VNewState "VNewState";
      printf "u_vSymbol:0x%x\n" u_vSymbol;
      printf "u_vNState:%x u_vNSymbol:%x\n" u_vNState u_vNSymbol;
      printf "u_vHeadPos:%x u_vNSymbol:%x\n" u_vHeadPos u_vNSymbol; cPrintMvar u_VTape "VTape";
      cPrintMvar u_VNTape "VNTape";
      printf "u_vNState:0x%x u_vNHeadPos:0x%x\n" u_vNState u_vNHeadPos;
      printf "u_vRet: 0x%x\n" u_vRet;
      *)
      let u_VNTape = (u_FReplaceSymbol (u_VTape) (u_vHeadPos) (u_vNSymbol)) in
      let u_vNDir = (cMatrixSingle u_VNewState (0, 2, 7, 0)) in
      let u_vNHeadPos =       if ((u_vNDir == u_vleft)) then begin
        u_vHeadPos - 1
      end else begin
        u_vHeadPos + 1
      end
      in
      printf "u_vNSymbol:%x u_vNState:%x u_vNHeadPos:%x\n" u_vNSymbol u_vNState u_vNHeadPos;
      (u_fSimulate (u_VNTape) (u_VAccepts) (u_VStates) (u_vNState) (u_vNHeadPos) (u_vBlank))
    end
  end
 in
  u_vRet
    end else begin
        0xfe
    end
end;;

let u_VInitTape = (cMatrixMake (1, 2, 8) [|u_va; u_vb|]);;

let u_VAcptStates = (cMatrixMake (1, 1, 8) [|u_vfive|]);;

let u_vTuringTest = (u_fSimulate (u_VInitTape) (u_VAcptStates) (u_VFSM) (u_vzero) (0) (u_vsharp));;


let _= cPrintSvar u_vTuringTest "vTuringTest";;


(*INFO: Work DONE!*)

